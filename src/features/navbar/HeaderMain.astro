---
import ThemeController from "@/components/ThemeController.astro";
import { PUBLIC_R2_URL } from "astro:env/client";

let avatarUrl = Astro.locals.avatar_url || "";
let userID = Astro.locals.user_id || "";
---

<header class="w-full bg-white shadow-md sticky top-0 z-50">
  <nav class="px-4 sm:px-6 w-full flex justify-between items-center h-16">
    <!-- Left section: logo + burger -->
    <div class="flex items-center gap-3">
      <!-- Hamburger (mobile only) -->
      <button id="menu-btn" class="md:hidden focus:outline-none">
        <svg class="w-7 h-7 text-gray-800" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

<!-- Logo -->
      <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        <img
          src=`${PUBLIC_R2_URL}ChatGPT%20Image%20Nov%204%2C%202025%2C%2002_47_13%20PM.png`
          alt="Tara G! Logo" class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg" />
        <span class="text-xl sm:text-2xl font-bold text-gray-800 hidden sm:inline">Tara G!</span>
        <span class="text-xl font-bold text-gray-800 sm:hidden">TG!</span>
      </a>
    </div>

<ul class="hidden lg:flex space-x-6 xl:space-x-8 items-center font-medium text-gray-700">
      <li><a href="/about" class="hover:text-blue-600 transition-colors">About</a></li>
      <li><a href="/discover" class="hover:text-blue-600 transition-colors">Discover</a></li>
      <li><a href="/blogs" class="hover:text-blue-600 transition-colors">Blogs</a></li>
    </ul>

    <div class="relative">
{userID ? (
        <button id="profile-btn" class="flex items-center gap-2 text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-lg p-1 transition-all">

          {avatarUrl ? (
            <img src={avatarUrl} alt="Profile" class="w-8 h-8 rounded-full border-2 border-gray-200" />
          ) : (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor" aria-hidden="true" class="w-8 h-8 text-gray-500">
              <circle cx="12" cy="8" r="4"/>
              <path d="M4 20c0-4 3-7 8-7s8 3 8 7" />
            </svg>
          )}
        </button>
      ) : (
        <a href="/signin" class="font-medium text-gray-700 hover:text-blue-600 bg-blue-50 hover:bg-blue-100 px-4 py-2 rounded-lg transition-colors">Sign in</a>
      )}

      <!-- Profile dropdown -->
      {userID  && (
        <ul id="profile-menu"
          class="hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
          <li><a href="/trips" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Trips</a></li>
          <li><a href="/settings" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Settings</a></li>
          <li><button class="block px-4 sign-out py-2 text-red-500 hover:bg-gray-100">Logout</button></li>
        </ul>
      )}
    </div>
  </nav>

<!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden lg:hidden bg-gray-50 border-t border-gray-200">
    <div class="p-4 sm:p-6">
      <ul class="flex flex-col space-y-4 text-gray-700 text-base sm:text-lg font-medium">
        <li><a href="/about" class="hover:text-blue-600 py-2 block transition-colors">About</a></li>
        <li><a href="/discover" class="hover:text-blue-600 py-2 block transition-colors">Discover</a></li>
        <li><a href="/blogs" class="hover:text-blue-600 py-2 block transition-colors">Blogs</a></li>
        <li class="pt-2 border-t border-gray-200"><ThemeController /></li>
        {userID ? (
          <>
            <li class="pt-4 border-t border-gray-200"><a href="/dashboard" class="hover:text-blue-600 py-2 block transition-colors">Dashboard</a></li>
            <li><button class="text-red-500 signout hover:text-red-600 py-2 text-left transition-colors">Logout</button></li>
          </>
        ) : (
          <li class="pt-4 border-t border-gray-200 space-y-2">
            <a href="/signin" class="hover:text-blue-600 py-2 block transition-colors">Sign in</a>
            <a href="/register" class="hover:text-blue-600 py-2 block transition-colors">Register</a>
          </li>
        )}
      </ul>
    </div>
  </div>
</header>

<script>
  import { actions } from "astro:actions";
  document.addEventListener('DOMContentLoaded', () => {
    const menuBtn = document.getElementById('menu-btn') as HTMLButtonElement;
    const mobileMenu = document.getElementById('mobile-menu') as HTMLDivElement;
    const profileBtn = document.getElementById('profile-btn') as HTMLButtonElement;
    const profileMenu = document.getElementById('profile-menu') as HTMLUListElement;
    const signOutBtns = document.querySelectorAll('.sign-out');

    if (menuBtn) {
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }

    if (profileBtn && profileMenu) {
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        profileMenu.classList.toggle('hidden');
      });

      document.addEventListener('click', (e) => {
        if (!profileMenu.contains(e.target as Node) && e.target !== profileBtn) {
          profileMenu.classList.add('hidden');
        }
      });
    }

    signOutBtns.forEach((btn) => {
      btn.addEventListener('click', async () => {
        await actions.auth.signout();
        window.location.href = '/signin';
      });
    });
  });
</script>
