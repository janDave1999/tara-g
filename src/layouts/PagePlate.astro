---
import type { PAGE_PLATE_PROPS } from "@/types/pageplates/types";
import Layout from "./Layout.astro";
import FooterMain from "@/features/footer/FooterMain.astro";
import Header from "@/features/navbar/Header.astro";
import SeoHead from "@/seo/component/SeoHead.astro";
import CookiesConsent from "@/components/CookiesConsent.astro";
import LoadModal from "@/components/LoadModal.astro";
import BottomNav from "@/features/navbar/BottomNav.astro";
import { PUBLIC_R2_URL } from 'astro:env/client';

let user_id = Astro.locals.user_id;
let avatar_url = Astro.locals.avatar_url;
let user_name = Astro.locals.username;
let full_name = Astro.locals.full_name || "";
const avatarUrl = avatar_url 
  ? (avatar_url.startsWith('http') ? avatar_url : `${PUBLIC_R2_URL}${avatar_url}`)
  : "";
interface Props extends PAGE_PLATE_PROPS {}

let {
  title = "Tara G!",
  noHeader = false,
  noFooter = false,
  noContainer = false,
  clean = false,
  expectedHeight = "min-h-screen",
  prefetch,
  description,
  html = {},
  containerClass = "",
} = Astro.props;

//---> Preflight
if(description == undefined){
  description = {
    title,
    type: "WebPage",
    description: "Discover amazing trips and experiences with Tara G!",
    author: "Tara G!",
    authorIs: "Organization",
  };
}
if(description && !description.title){
  description.title = title;
}
---

<Layout title={title} html={html}>
  <Fragment slot={`head-last`}>
    <SeoHead description={description} prefetch={prefetch} showFb={!!description?.fbAppId} />
    <slot name="head-extra" />
  </Fragment>
    {clean?"":<>
      {noHeader ? "":<>
        <Header
          userId={user_id}
          avatarUrl={avatarUrl}
          username={Astro.locals.username}
          fullName={full_name}
        />
        <!-- Spacer so fixed header doesn't overlap content -->
        <div class="h-14 sm:h-16" aria-hidden="true"></div>
      </>}
    </>}
    <main>
    <slot name="header" />

{noContainer ?<>
      <slot />
      {user_id && <div class="h-16 md:hidden" aria-hidden="true"></div>}
      </>:<>
      <div
        class={`container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 py-4 sm:py-6 md:py-8 lg:py-12 relative ${containerClass}`}
      >
      <slot />
    </div>
    {user_id && <div class="h-16 md:hidden" aria-hidden="true"></div>}
    </>}
    </main>
    <CookiesConsent />
    <LoadModal />
    {
     user_id ? <BottomNav currentPath={Astro.url.pathname} /> : ""
    }
    {clean?"": <>
      {noFooter ? "":<>
        <FooterMain />
      </>}
    </>}
</Layout>