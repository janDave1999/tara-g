---
import AuthLayout from "@/layouts/AuthLayout.astro";

const { cookies, redirect } = Astro;

// Already logged-in users don't need to be here
const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");
if (accessToken && refreshToken) {
  return redirect("/feeds");
}
---

<AuthLayout title="Email Confirmed â€” Tara G!" noIndex>
  <div class="bg-white shadow-xl rounded-2xl p-6 sm:p-8 space-y-6 text-center">
    <!-- Success Icon -->
    <div class="flex justify-center">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center">
        <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      </div>
    </div>

    <!-- Heading -->
    <div>
      <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900">Email Confirmed!</h1>
      <p class="text-gray-600 mt-2 text-sm sm:text-base">
        Your account has been successfully verified.
      </p>
    </div>

    <!-- Instructions -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-left">
      <p class="text-sm text-green-800 font-medium mb-2">What's next:</p>
      <ol class="text-sm text-green-700 space-y-1 list-decimal list-inside">
        <li>Sign in to your account</li>
        <li>Complete your profile</li>
        <li>Start exploring trips!</li>
      </ol>
    </div>

    <!-- Auto-redirect countdown -->
    <div class="space-y-3">
      <p class="text-sm text-gray-500" id="countdownText">
        Redirecting to sign in in <span id="countdown" class="font-semibold text-blue-600">10</span> seconds...
      </p>
      
      <a
        href="/signin"
        id="signinButton"
        class="
          block w-full py-3 bg-blue-600 text-white font-medium rounded-lg
          hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 transition
        "
      >
        Sign in now
      </a>
    </div>

    <!-- Footer -->
    <div class="pt-4 border-t border-gray-100">
      <p class="text-sm text-gray-500">
        Didn't receive the email?
        <a href="/register" class="text-blue-600 font-medium hover:text-blue-700 transition-colors">
          Create a new account
        </a>
      </p>
    </div>
  </div>
</AuthLayout>

<script>
  let seconds = 10;
  const countdownEl = document.getElementById('countdown')!;
  const countdownText = document.getElementById('countdownText')!;
  const signinButton = document.getElementById('signinButton')!;

  const timer = setInterval(() => {
    seconds--;
    countdownEl.textContent = seconds.toString();

    if (seconds <= 0) {
      clearInterval(timer);
      window.location.href = '/signin';
    }
  }, 1000);

  // Stop countdown if user clicks sign in
  signinButton.addEventListener('click', () => {
    clearInterval(timer);
  });
</script>
